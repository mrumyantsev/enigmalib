# Шифровальные машины

**Шифровальные машины** - это веб-приложение, предназначенное для перевода текста в шифр, в точности реализующее механизм шифровальных машин фирмы "Enigma", выпускавшихся в Германии с начала 20-х годов XX века, а также поздних измененных моделей, предназначавшихся для работы госструктур в других странах после Второй мировой войны.

![Шифровальные машины](./cipher-machines-web-ui.png "Веб-интерфейс приложения \"Шифровальные машины\"")\
*Вид приложения в браузере*

## Машины "Enigma"

Шифровальные машины марки "Enigma" являются роторными машинами, в которых каждое нажатие на клавишу связано с поворотом на одну позицию как минимум одного из ее роторов. 

### Алгоритм работы

1. Нажатие клавиши на клавиатуре замыкает электрический контакт нажатой буквы и приводит в движение крайний правый ротор (rotor), и, если соседние роторы стоят на выемке (at notch), то повороту и их, на одну позицию вперед.
2. Электрический ток, идущий от батареи (или источника питания), проходит коммутационную панель (plugboard), и меняет направление с буквы на букву, если текущая буква была соединена с другой проводом с 2-я штекерами.
3. Ток проходит через статор, и, в зависимости от модели машины, может менять букву на другую.
4. Буквы меняются проходя через контакты каждого из роторов, от последнего ротора к первому.
5. Из первого ротора ток перетекает на рефлектор (reflector), задача которого поменять букву и пустить ток в обратном направлении - в первый ротор.
6. Далее, ток снова идет через все роторы, на этот раз - от первого ротора к последнему.
7. Из последнего ротора условная буква попадает на статор, где так же может поменяться, в зависимости от модели машины.
8. На последнем шаге буква из статора должна пройти через коммутационную панель снова, где она может поменяться, если к ней, а также другой букве, подключен провод со штекерами.
9. В итоге, буква, прошедшая весь этот путь от клавиатуры, перемешиваясь через роторы и проходя штекерные соединения, загорается на панели лампочек в виде зашифрованной буквы.

![Enigma](./Assembled-machine-with-all-components-5.png "Вид шифровальной машины \"Enigma\" и схема ее работы")\
*Вид шифровальной машины \"Enigma\" и схема ее работы*

### Сложность шифра

Машины марки "Enigma" всегда шифруют исходный тест симметричным шифром (количество букв исходного и зашифрованного текстов всегда совпадает). Длина одного такого ключа на 3-роторной машине с 10-ю подключенными перемычками на коммутационной панели составляет 158 962 555 217 826 360 000 комбинаций.

### Взлом

Несмотря на внушительную длину ключа по своим временам, серьезным недостатком машин "Enigma" является гарантированное превращение исходной буквы в любую другую, но не ту же самую букву, что была в тексте изначально. Эта уязвимость шифра впервые натолкнула на мысль польских ученых еще в конце 30-х годов. Им удалось создать автоматические машины под названием "Bombe" ("Бомба") для подбора настроек машины, исходя из предугаданного текста в исходных сообщениях.

Во времена Второй мировой войны немецкие армейские части вели обязательные утренние передачи друг другу сводок о погоде, в которых неизменными были начальные слова и сам смысл фразы на немецком языке. Однако ключ для шифрования радиограмм должен был меняться каждый день, исходя из секретных инструкций для радистов по настройке машины на каждый день.

В конце концов "Enigma" была окончательно "взломана", когда главное шифровальное подразделение Великобритании - Блетчли-парк (Bletchley Park) и около 16 000 его сотрудников под руководством Алана Тьюринга разработали первый в мире компьютер - "Бомбу Тьюринга", требовавшийся тогда, чтобы уметь подбирать как можно быстрее ключ сегодняшнего дня, для дешифрования вражеских сообщений.

## Пакеты для импортирования

* `pkg/machine` - вспомогательные типы для инициализации любых шифровальных машин и для работы веб-сервера данного проекта
* `pkg/machine/enigma` - конкретные моделями машин Enigma
* `pkg/machine/enigma/base` - базовые детали для построения новой машины с механизмом Enigma

## Системные требования

**Операционная система:**

- Windows / MacOS / Linux.

**Программное обеспечение:**

- средства разработки языка Go >=v1.20 (только для локальной сборки);
- платформа контейнеризации Docker;
- утилита make.

## Установка и запуск

Для **сборки** приложения в **Docker** выполните эту команду:

#### Для Linux:

```
docker compose build
```

#### Для MacOS:

```
docker-compose build
```

Для **запуска** приложения в контейнерах **Docker** выполните следующую команду (она также запустит сборку, если таковой не было произведено):

#### Для Linux:

```
docker compose up
```

#### Для MacOS:

```
docker-compose up
```

Чтобы воспользоваться **веб-интерфейсом** приложения откройте интернет-браузер и перейдите в нем по адресу:

```
http://localhost:8090/
```

Для того, чтобы **остановить** запущенные **Docker**-контейнеры и конфигурации текущего развертывания, выполните команду:

#### Для Linux:

```
docker compose down
```

#### Для MacOS:

```
docker-compose down
```

Для **сборки серверного компонента** приложения на **локальном** компьютере выполните команду:

```
make build
```

Чтобы **запустить серверный компонент** приложения на **локальном** компьютере выполните следующую команду:

```
make run
```

Чтобы **запустить демонстрацию**, выполните команду:

```
make demo-run
```

Или выполните ее короткую версию:

```
make
```

## Траблшутинг

Если при развертывании в Docker постоянно появляется ошибка *"This port already in use"* попробуйте поменять этот порт, о котором говорится в ошибке, с помощью того же файла с параметрами `.env`.

Если при открытии веб-интерфейса приложения в браузере появляется страница с ошибкой *"Could not resolve host: localhost"*, замените в поле адреса слово `localhost` на `127.0.0.1` и перейдите по данному адресу.
